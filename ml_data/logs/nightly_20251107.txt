(.venv) C:\Users\Xaphi\sap_env>python -m backend.nightly_job
[2025-11-07 21:26:23] ğŸ› ï¸  Nightly Job â€” AION Analytics (Rolling-Native v3.2)
[2025-11-07 21:26:29] ğŸ“¦ Rolling present â€” 5547 tickers loaded.
[2025-11-07 21:26:29] â€”â€”â€” Heal rolling cache (batch + self-heal) â€”â€”â€”
Healing |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5547/5547 (100.0%) ETA 0s  343746.6/s  0.0/s
[2025-11-07 21:26:41] ğŸ§© Backfill mode: FULL | Date: 2025-11-08
[2025-11-07 21:26:41] ğŸ”§ Starting full rolling backfill for 5547 symbols (batch SA fetch)...
[2025-11-07 21:26:44] ğŸ”§ Normalization summary â€” 5526 tickers, ~60389 fields normalized (rsiâ†’rsi_14 included).
[2025-11-07 21:26:46] âœ… Saved StockAnalysis bundle â†’ metrics_cache\bundle\sa_bundle_2025-11-08.json.gz
[2025-11-07 21:26:46] [metrics_fetcher] ğŸš€ Starting incremental metrics update...
[2025-11-07 21:26:52] [metrics_fetcher] ğŸ§© Missing or incomplete metrics: 21 fields â†’ ['ch6m', 'ch1y', 'chYTD', 'ma200', 'beta', 'peRatio', 'pbRatio', 'psRatio', 'pegRatio', 'fcfYield', 'earningsYield', 'roa', 'roe', 'roic', 'profitMargin', 'operatingMargin', 'grossMargin', 'revenueGrowth', 'epsGrowth', 'debtEquity', 'debtEbitda']
[2025-11-07 21:27:01] ğŸ©¹ Missing ['symbol', 'history', 'sector', 'pe_ratio', 'marketCap', 'close'] for WSTN, fetching from StockAnalysis...
[2025-11-07 21:27:08] ğŸ©¹ Missing ['symbol', 'history', 'sector', 'pe_ratio', 'marketCap', 'close'] for ALPS, fetching from StockAnalysis...
[2025-11-07 21:27:09] [metrics_fetcher] âœ… Incremental metrics update complete â€” 0 tickers updated in 22.8s.
(5547/5547) â€” 100.0% done | 5521 updated[2025-11-07 21:28:00]
âœ… Backfill (full) complete â€” 5521/5547 updated in 78.7s.
[2025-11-07 21:28:00] âœ… Heal complete in 90.9s.
[2025-11-07 21:28:00] â€”â€”â€” Backfill (today's bars) â€”â€”â€”
Backfill |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5547/5547 (100.0%) ETA 0s  282410.3/s  0.0/s
[2025-11-07 21:28:13] ğŸ§© Backfill mode: FULL | Date: 2025-11-08
[2025-11-07 21:28:14] ğŸ”§ Starting full rolling backfill for 5547 symbols (batch SA fetch)...
[2025-11-07 21:28:16] ğŸ”§ Normalization summary â€” 5526 tickers, ~60389 fields normalized (rsiâ†’rsi_14 included).
[2025-11-07 21:28:18] âœ… Saved StockAnalysis bundle â†’ metrics_cache\bundle\sa_bundle_2025-11-08.json.gz
[2025-11-07 21:28:18] [metrics_fetcher] ğŸš€ Starting incremental metrics update...
[2025-11-07 21:28:24] [metrics_fetcher] ğŸ§© Missing or incomplete metrics: 21 fields â†’ ['ch6m', 'ch1y', 'chYTD', 'ma200', 'beta', 'peRatio', 'pbRatio', 'psRatio', 'pegRatio', 'fcfYield', 'earningsYield', 'roa', 'roe', 'roic', 'profitMargin', 'operatingMargin', 'grossMargin', 'revenueGrowth', 'epsGrowth', 'debtEquity', 'debtEbitda']
[2025-11-07 21:28:31] ğŸ©¹ Missing ['symbol', 'history', 'sector', 'pe_ratio', 'marketCap', 'close'] for WSTN, fetching from StockAnalysis...
[2025-11-07 21:28:39] ğŸ©¹ Missing ['symbol', 'history', 'sector', 'pe_ratio', 'marketCap', 'close'] for ALPS, fetching from StockAnalysis...
[2025-11-07 21:28:40] [metrics_fetcher] âœ… Incremental metrics update complete â€” 0 tickers updated in 22.5s.
(5547/5547) â€” 100.0% done | 5521 updated[2025-11-07 21:29:32]
âœ… Backfill (full) complete â€” 5521/5547 updated in 78.2s.
[2025-11-07 21:29:32] âœ… Backfill complete in 84.2s for 5547 tickers.
[2025-11-07 21:29:32] â€”â€”â€” Metrics refresh (StockAnalysis) â€”â€”â€”
[2025-11-07 21:29:32] [metrics_fetcher] ğŸš€ Starting incremental metrics update...
[2025-11-07 21:29:38] [metrics_fetcher] ğŸ§© Missing or incomplete metrics: 21 fields â†’ ['ch6m', 'ch1y', 'chYTD', 'ma200', 'beta', 'peRatio', 'pbRatio', 'psRatio', 'pegRatio', 'fcfYield', 'earningsYield', 'roa', 'roe', 'roic', 'profitMargin', 'operatingMargin', 'grossMargin', 'revenueGrowth', 'epsGrowth', 'debtEquity', 'debtEbitda']
[2025-11-07 21:29:45] ğŸ©¹ Missing ['symbol', 'history', 'sector', 'pe_ratio', 'marketCap', 'close'] for WSTN, fetching from StockAnalysis...
[2025-11-07 21:29:51] ğŸ©¹ Missing ['symbol', 'history', 'sector', 'pe_ratio', 'marketCap', 'close'] for ALPS, fetching from StockAnalysis...
[2025-11-07 21:30:08] [metrics_fetcher] âœ… Incremental metrics update complete â€” 0 tickers updated in 36.1s.
[2025-11-07 21:30:09] â€”â€”â€” Weekly aggregate â€”â€”â€”
[2025-11-07 21:31:42] âœ… Weekly compression complete â€” 16586 rows â†’ C:\Users\Xaphi\sap_env\ml_data\training_data_weekly.parquet (93.3s)
[2025-11-07 21:31:42] â€”â€”â€” Monthly aggregate â€”â€”â€”
[2025-11-07 21:33:10] âœ… Monthly compression complete â€” 11062 rows â†’ C:\Users\Xaphi\sap_env\ml_data\training_data_monthly.parquet (87.2s)
[2025-11-07 21:33:10] â€”â€”â€” Context enrichment â€”â€”â€”
[2025-11-07 21:34:09] âœ… Context enrichment applied â€” 5547 symbols updated (macro/sentiment/sector/trend).
[2025-11-07 21:34:10] â€”â€”â€” News Intelligence â€”â€”â€”
[2025-11-07 21:34:10] ğŸš€ Running News Intelligence module...
Exception in thread Thread-1 (_readerthread):
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\threading.py", line 1038, in _bootstrap_inner
    self.run()
  File "C:\Program Files\Python311\Lib\threading.py", line 975, in run
    self._target(*self._args, **self._kwargs)
  File "C:\Program Files\Python311\Lib\subprocess.py", line 1550, in _readerthread
    buffer.append(fh.read())
                  ^^^^^^^^^
  File "C:\Program Files\Python311\Lib\encodings\cp1252.py", line 23, in decode
    return codecs.charmap_decode(input,self.errors,decoding_table)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeDecodeError: 'charmap' codec can't decode byte 0x8f in position 40: character maps to <undefined>
[2025-11-07 21:34:12] âœ… News Intelligence completed successfully.
[2025-11-07 21:34:12] â€”â€”â€” Build ML datasets (rolling-native) â€”â€”â€”
[2025-11-07 21:34:12] [ml_data_builder] ğŸš€ Building ML dataset from Rolling (horizon=daily)...
[2025-11-07 21:35:02] ğŸ©¹ Missing ['sector', 'pe_ratio', 'marketCap', 'close'] for CRA, fetching from StockAnalysis...
HTTP Error 404: {"quoteSummary":{"result":null,"error":{"code":"Not Found","description":"Quote not found for symbol: DD.WI"}}}
[2025-11-07 21:35:26] ğŸ©¹ Missing ['sector', 'pe_ratio', 'marketCap', 'close'] for DD.WI, fetching from StockAnalysis...
HTTP Error 404: {"quoteSummary":{"result":null,"error":{"code":"Not Found","description":"Quote not found for symbol: Q.WI"}}}
[2025-11-07 21:35:33] ğŸ©¹ Missing ['sector', 'pe_ratio', 'marketCap', 'close'] for Q.WI, fetching from StockAnalysis...
[2025-11-07 21:35:40] ğŸ©¹ Missing ['pe_ratio'] for APXT, fetching from StockAnalysis...
[2025-11-07 21:35:46] ğŸ©¹ Missing ['pe_ratio'] for DNMX, fetching from StockAnalysis...
[2025-11-07 21:35:53] ğŸ©¹ Missing ['pe_ratio'] for DYOR, fetching from StockAnalysis...
[2025-11-07 21:36:02] ğŸ©¹ Missing ['pe_ratio'] for CCC, fetching from StockAnalysis...
[2025-11-07 21:36:09] ğŸ©¹ Missing ['pe_ratio'] for NCEL, fetching from StockAnalysis...
[2025-11-07 21:36:15] ğŸ©¹ Missing ['pe_ratio'] for NOMA, fetching from StockAnalysis...
[2025-11-07 21:36:30] ğŸ©¹ Missing ['pe_ratio'] for BETA, fetching from StockAnalysis...
[2025-11-07 21:36:49] ğŸ©¹ Missing ['pe_ratio', 'marketCap'] for SUNC, fetching from StockAnalysis...
[2025-11-07 21:37:07] ğŸ©¹ Missing ['pe_ratio'] for MEHA, fetching from StockAnalysis...
[2025-11-07 21:37:14] ğŸ©¹ Missing ['pe_ratio'] for BLLN, fetching from StockAnalysis...
[2025-11-07 21:37:21] ğŸ©¹ Missing ['pe_ratio'] for EVMN, fetching from StockAnalysis...
[2025-11-07 21:37:27] ğŸ©¹ Missing ['pe_ratio'] for ELWT, fetching from StockAnalysis...
[2025-11-07 21:37:34] ğŸ©¹ Missing ['pe_ratio'] for CEPV, fetching from StockAnalysis...
[2025-11-07 21:37:50] âœ… One-hot encoded 14 sector features
[2025-11-07 21:37:50] âœ… ML dataset built â€” 5546 rows â†’ C:\Users\Xaphi\sap_env\ml_data\training_data_daily.parquet
[2025-11-07 21:37:51] [ml_data_builder] ğŸš€ Building ML dataset from Rolling (horizon=weekly)...
[2025-11-07 21:38:43] ğŸ©¹ Missing ['sector', 'pe_ratio', 'marketCap', 'close'] for CRA, fetching from StockAnalysis...
HTTP Error 404: {"quoteSummary":{"result":null,"error":{"code":"Not Found","description":"Quote not found for symbol: DD.WI"}}}
[2025-11-07 21:39:07] ğŸ©¹ Missing ['sector', 'pe_ratio', 'marketCap', 'close'] for DD.WI, fetching from StockAnalysis...
HTTP Error 404: {"quoteSummary":{"result":null,"error":{"code":"Not Found","description":"Quote not found for symbol: Q.WI"}}}
[2025-11-07 21:39:14] ğŸ©¹ Missing ['sector', 'pe_ratio', 'marketCap', 'close'] for Q.WI, fetching from StockAnalysis...
[2025-11-07 21:39:21] ğŸ©¹ Missing ['pe_ratio'] for APXT, fetching from StockAnalysis...
[2025-11-07 21:39:27] ğŸ©¹ Missing ['pe_ratio'] for DNMX, fetching from StockAnalysis...
[2025-11-07 21:39:34] ğŸ©¹ Missing ['pe_ratio'] for DYOR, fetching from StockAnalysis...
[2025-11-07 21:39:40] ğŸ©¹ Missing ['pe_ratio'] for CCC, fetching from StockAnalysis...
[2025-11-07 21:39:46] ğŸ©¹ Missing ['pe_ratio'] for NCEL, fetching from StockAnalysis...
[2025-11-07 21:39:53] ğŸ©¹ Missing ['pe_ratio'] for NOMA, fetching from StockAnalysis...
[2025-11-07 21:40:06] ğŸ©¹ Missing ['pe_ratio'] for BETA, fetching from StockAnalysis...
[2025-11-07 21:40:24] ğŸ©¹ Missing ['pe_ratio', 'marketCap'] for SUNC, fetching from StockAnalysis...
[2025-11-07 21:40:43] ğŸ©¹ Missing ['pe_ratio'] for MEHA, fetching from StockAnalysis...
[2025-11-07 21:40:49] ğŸ©¹ Missing ['pe_ratio'] for BLLN, fetching from StockAnalysis...
[2025-11-07 21:40:56] ğŸ©¹ Missing ['pe_ratio'] for EVMN, fetching from StockAnalysis...
[2025-11-07 21:41:02] ğŸ©¹ Missing ['pe_ratio'] for ELWT, fetching from StockAnalysis...
[2025-11-07 21:41:11] ğŸ©¹ Missing ['pe_ratio'] for CEPV, fetching from StockAnalysis...
[2025-11-07 21:41:12] âœ… One-hot encoded 14 sector features
[2025-11-07 21:41:12] âœ… ML dataset built â€” 5546 rows â†’ C:\Users\Xaphi\sap_env\ml_data\training_data_weekly.parquet
[2025-11-07 21:41:13] â€”â€”â€” Model training â€”â€”â€”
[train_lightgbm] ğŸš€ Starting full model training...
[train_lightgbm] âœ… Training complete for 0 datasets.
[2025-11-07 21:41:13] â€”â€”â€” AI model predictions â†’ Rolling â€”â€”â€”
[2025-11-07 21:41:18] âš™ï¸ Starting AI model predictions across 5,547 symbols...
Predicting: 100%|#######################| 5547/5547 [8:22:55<00:00,  5.44s/tick]
[2025-11-08 06:04:14] âœ… Predictions complete â€” 0/5,547 symbols scored in 30176.0s (0.2/s)
[2025-11-08 06:05:06] ğŸ¤– Predictions updated for 0 symbols in Rolling.
[2025-11-08 06:05:06] ğŸ§¾ Predictions logged â†’ C:\Users\Xaphi\sap_env\ml_data\prediction_logs\preds_20251108T130506Z_v20251108_130506.jsonl
â„¹ï¸ No new outcomes to train from (no_outcomes).
[2025-11-08 06:05:09] ğŸ” Incremental training completed â†’ no_outcomes (None)
[2025-11-08 06:05:09] â€”â€”â€” News Intelligence â€”â€”â€”
[2025-11-08 06:05:09] [news_intel] â„¹ï¸ no raw news today â€” nothing to analyze.
[2025-11-08 06:05:09] â€”â€”â€” Event Outcome Harvest â€”â€”â€”
[2025-11-08 06:05:10] [event_outcomes] â„¹ï¸ no event files found.
[2025-11-08 06:05:10] â€”â€”â€” Drift monitoring & Rolling Brain update â€”â€”â€”
[2025-11-08 06:05:10] âš ï¸ Drift/Brain update failed: name 'PATHS' is not defined
[2025-11-08 06:05:10] â€”â€”â€” Insights generation (Top 50) â€”â€”â€”
[2025-11-08 06:05:15] [insights_builder] ğŸš€ Building Top-50 Insights from existing predictions (5,547 symbols)...
Aggregating predictions: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 5547/5547 [00:00<00:00, 43166.84ticker/s]
[2025-11-08 06:05:15] âœ… Wrote Top-50 (1w) â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_1w.json
[2025-11-08 06:05:15] âœ… Wrote Top-50 (2w) â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_2w.json
[2025-11-08 06:05:15] âœ… Wrote Top-50 (4w) â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_4w.json
[2025-11-08 06:05:15] âœ… Wrote Top-50 (52w) â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_52w.json

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Insights build complete for 5,547 symbols.
ğŸ“Š Total predictions processed: 22,052
   â€¢ 1w:  50 tickers â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_1w.json
   â€¢ 2w:  50 tickers â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_2w.json
   â€¢ 4w:  50 tickers â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_4w.json
   â€¢ 52w:  50 tickers â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history\top50_52w.json
â±ï¸ Completed in 5.2s (read-only aggregation).
ğŸ“ Saved outputs â†’ C:\Users\Xaphi\sap_env\ml_data\insights_history/top50_*.json
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2025-11-08 06:05:15] â€”â€”â€” Cloud sync (Supabase) â€”â€”â€”
[2025-11-08 06:05:15] â˜ï¸ Supabase sync unavailable (cloud_sync missing). Skipping.
[2025-11-08 06:05:15]
âœ… Nightly job complete in 31132.5s.
{'status': 'ok', 'heal': 'ok', 'backfill': '5547 tickers', 'metrics': 'ok', 'weekly_file': 'C:\\Users\\Xaphi\\sap_env\\ml_data\\training_data_weekly.parquet', 'monthly_file': 'C:\\Users\\Xaphi\\sap_env\\ml_data\\training_data_monthly.parquet', 'ml_daily_rows': 5546, 'ml_weekly_rows': 5546, 'training': {}, 'brain': "error: name 'PATHS' is not defined", 'insights': {'outputs': {'1w': {'count': 50, 'path': 'C:\\Users\\Xaphi\\sap_env\\ml_data\\insights_history\\top50_1w.json'}, '2w': {'count': 50, 'path': 'C:\\Users\\Xaphi\\sap_env\\ml_data\\insights_history\\top50_2w.json'}, '4w': {'count': 50, 'path': 'C:\\Users\\Xaphi\\sap_env\\ml_data\\insights_history\\top50_4w.json'}, '52w': {'count': 50, 'path': 'C:\\Users\\Xaphi\\sap_env\\ml_data\\insights_history\\top50_52w.json'}}}, 'synced': True, 'predictions': 0, 'incremental': {'status': 'no_outcomes'}}
