# dt_knobs.env â€” generated from project scan (dt_backend knobs)
# Put this next to your main .env and have dt_backend load it in addition.
# Lines with blank values mean the code default is computed or unclear; leave blank to use code defaults.


# DT_ALLOW_SHORTS: default from dt_backend/historical_replay/backtest_runner_dt.py
DT_ALLOW_SHORTS=0

# DT_APP_HOST: default from run_backend.py
DT_APP_HOST=0.0.0.0

# DT_APP_PORT: default from run_backend.py
DT_APP_PORT=8010

# DT_BACKTEST_START_EQUITY: default from dt_backend/historical_replay/backtest_runner_dt.py
DT_BACKTEST_START_EQUITY=100000

# DT_BARS_MIN_GAP_SEC_1M: no default found
DT_BARS_MIN_GAP_SEC_1M=30

# DT_CANDIDATE_UNIVERSE: default from dt_backend/core/meta_controller_dt.py
DT_CANDIDATE_UNIVERSE=SPY,QQQ,AAPL,MSFT,TSLA,NVDA,AMD,GOOGL,META,AMZN

# DT_CANDIDATE_UNIVERSE_FILE: default from dt_backend/core/meta_controller_dt.py
DT_CANDIDATE_UNIVERSE_FILE=

# DT_CYCLE_LOCK: default from dt_backend/jobs/daytrading_job.py
DT_CYCLE_LOCK=1

# DT_CYCLE_LOCK_TIMEOUT: default from dt_backend/jobs/daytrading_job.py
DT_CYCLE_LOCK_TIMEOUT=5

# DT_DECISION_LOG_TOP_N: default from dt_backend/jobs/daytrading_job.py
DT_DECISION_LOG_TOP_N=25

# DT_EXEC_DEFAULT_QTY: default from dt_backend/historical_replay/backtest_runner_dt.py
DT_EXEC_DEFAULT_QTY=1

# DT_EXEC_MIN_CONF: default from dt_backend/historical_replay/backtest_runner_dt.py
# Raised from 0.25 to 0.45 to reduce overtrading and improve conviction threshold
DT_EXEC_MIN_CONF=0.45

# DT_FEATURE_TF: default from dt_backend/engines/feature_engineering.py
DT_FEATURE_TF=5Min

# DT_FORCE_NEW_PLAN: default from dt_backend/jobs/daytrading_job.py
DT_FORCE_NEW_PLAN=0

# DT_IGNORE_MICRO_REGIME: no default found
DT_IGNORE_MICRO_REGIME=0

# DT_LOCK_PATH: default from dt_backend/core/data_pipeline_dt.py
DT_LOCK_PATH=

# DT_LOCK_TIMEOUT: default from dt_backend/core/data_pipeline_dt.py
DT_LOCK_TIMEOUT=60

# DT_MARKET_PROXIES: default from dt_backend/core/meta_controller_dt.py
DT_MARKET_PROXIES=SPY,QQQ

# DT_MAX_ORDERS_PER_CYCLE: default from dt_backend/historical_replay/backtest_runner_dt.py
DT_MAX_ORDERS_PER_CYCLE=3

# DT_MAX_POSITIONS: default from dt_backend/historical_replay/backtest_runner_dt.py
DT_MAX_POSITIONS=3

# DT_MODEL_LOCK_TIMEOUT: default from dt_backend/ml/train_lightgbm_intraday.py
DT_MODEL_LOCK_TIMEOUT=180

# DT_NOW_UTC: default from dt_backend/core/time_override_dt.py
DT_NOW_UTC=

# DT_REPLAY_VERSION: default from dt_backend/historical_replay/historical_replay_manager.py
DT_REPLAY_VERSION=phase6_v1

# DT_RESEARCHER_RULES_PATH: default from dt_backend/researcher/rules_runtime_dt.py
DT_RESEARCHER_RULES_PATH=

# DT_ROLLING_PATH: default from dt_backend/core/data_pipeline_dt.py
DT_ROLLING_PATH=da_brains/intraday/rolling_intraday.json.gz

# DT_SCHED_TICK_SEC: default from dt_backend/jobs/dt_scheduler.py
DT_SCHED_TICK_SEC=60

# DT_SHADOW_ENABLED: default from dt_backend/core/meta_controller_dt.py
DT_SHADOW_ENABLED=0

# DT_SHADOW_EVERY_N: default from dt_backend/jobs/daytrading_job.py
DT_SHADOW_EVERY_N=1

# DT_SHADOW_TOP_N: default from dt_backend/shadow/shadow_cycle_dt.py
DT_SHADOW_TOP_N=25

# DT_SHADOW_VERSION: default from dt_backend/shadow/shadow_cycle_dt.py
DT_SHADOW_VERSION=

# DT_STRATEGY_VERSION: no default found
DT_STRATEGY_VERSION=

# DT_TRADE_INTERVAL_SEC: default from dt_backend/jobs/dt_scheduler.py
DT_TRADE_INTERVAL_SEC=300

# DT_TRUTH_DIR: default from dt_backend/calibration/phit_calibrator_dt.py
DT_TRUTH_DIR=

# DT_UNIVERSE_FILE: default from dt_backend/core/meta_controller_dt.py
DT_UNIVERSE_FILE=

# DT_USE_LOCK: default from dt_backend/core/data_pipeline_dt.py
DT_USE_LOCK=1

# REPLAY_APP_HOST: default from run_backend.py
REPLAY_APP_HOST=0.0.0.0

# REPLAY_APP_PORT: default from run_backend.py
REPLAY_APP_PORT=8020

DT_ALLOW_MODEL_FALLBACK=1
DT_UNIVERSE_SIZE=150
DT_CANDIDATE_UNIVERSE_N=2000
DT_BUY_THRESHOLD=0.10
DT_SELL_THRESHOLD=-0.10
DT_MIN_CONFIDENCE=0.26
DT_ALLOW_LUNCH_TRADES=1

# ---------------------
# Knob hot-reload (dt_knobs.env re-read while scheduler is running)
# ---------------------
# 1 enables hot-reload each cycle (default in code is on).
DT_KNOBS_HOT_RELOAD=1
# Minimum seconds between checks for file changes.
DT_KNOBS_RELOAD_MIN_SEC=1.0
# Optional: override knobs file path. Leave blank to use default.
# DT_KNOBS_PATH=/home/aion/aion/Aion_Analytics/dt_knobs.env

# ---------------------
# Ledger reconciliation + liquidation levers
# ---------------------
DT_STRATEGY_TAG=DT
DT_DRY_RUN=0

# Start-up broker->ledger reconciliation (runs once per process start)
DT_LEDGER_RECONCILE_ON_STARTUP=1
DT_LEDGER_RECONCILE_MODE=IMPORT
DT_LEDGER_RECONCILE_SYNC_CASH=0

# Liquidation (sell down to target positions)
DT_LIQUIDATE_ENABLED=1
DT_LIQUIDATE_TARGET_POSITIONS=0
DT_LIQUIDATE_SCOPE=ALL
DT_LIQUIDATE_MAX_ORDERS_PER_CYCLE=50

DT_RISK_EQUITY_SOURCE=auto
DT_LIQUIDATE_DEDUP_ENABLED=1
DT_LIQUIDATE_INFLIGHT_TTL_SEC=180

# --- Position ownership / registry ---
AION_POSITION_REGISTRY_PATH=/home/aion/aion/Aion_Analytics/da_brains/positions/position_registry.json
# Optional: if you want DT truth dir to relocate DT artifacts
DT_TRUTH_DIR=/home/aion/aion/Aion_Analytics/da_brains

# === Trade Frequency Controls (Fix #1) ===
# Minimum minutes between trades on same symbol (prevents churn)
DT_MIN_TRADE_GAP_MINUTES=15

# Minimum hold time before exit considered (prevents fast flips)
DT_MIN_HOLD_TIME_MINUTES=10

# === Score Decay (Fix #2) ===
# Score decay window (minutes) - penalize recently-acted symbols
DT_SCORE_DECAY_MINUTES=30

# === Universe Rotation (Fix #3) ===
# Enable universe rotation (filter out recently traded stocks)
DT_UNIVERSE_ROTATION=1
# Hours to exclude a symbol after exit (encourages rotation)
DT_UNIVERSE_COOLDOWN_HOURS=2

# === Daily Limits (Fix #4) ===
# Maximum entries per symbol per day (0 = unlimited)
DT_MAX_TRADES_PER_SYMBOL_PER_DAY=2

# === Debug Logging ===
DT_LOG_SKIPPED_SETUPS=1

# ======================================================
# Risk Management Enhancements (Phase 3)
# ======================================================

# Weekly drawdown cap (percentage)
DT_MAX_WEEKLY_DRAWDOWN_PCT=8.0

# Monthly drawdown cap (percentage)
DT_MAX_MONTHLY_DRAWDOWN_PCT=15.0

# VIX spike protection threshold
DT_VIX_SPIKE_THRESHOLD=35.0

# Pause trading on VIX spike (0=disabled, 1=enabled)
DT_PAUSE_ON_VIX_SPIKE=1

# Maximum loss per symbol per day (USD)
DT_MAX_LOSS_PER_SYMBOL_DAY=500.0

# ======================================================
# Safety Mechanisms (Phase 4)
# ======================================================

# Emergency stop file path
DT_EMERGENCY_STOP_FILE=/tmp/dt_emergency_stop

