# ======================================================
# AION Analytics Environment Configuration Template
# ======================================================
# Copy this file to .env and fill in your actual values
# DO NOT commit .env to version control!
#
# Required: Alpaca API credentials (minimum for trading)
# Optional: Other data sources enhance system capabilities
# ======================================================

# ======================================================
# ALPACA TRADING API (REQUIRED)
# ======================================================
# Get your API keys from: https://app.alpaca.markets/paper/dashboard/overview
# Paper trading (recommended for testing): https://paper-api.alpaca.markets
# Live trading: https://api.alpaca.markets

ALPACA_API_KEY_ID="YOUR_ALPACA_API_KEY_HERE"
ALPACA_API_SECRET_KEY="YOUR_ALPACA_SECRET_KEY_HERE"
ALPACA_PAPER_BASE_URL="https://paper-api.alpaca.markets"

# For live trading (use with extreme caution):
# ALPACA_LIVE_BASE_URL="https://api.alpaca.markets"

# ======================================================
# POLYGON.IO MARKET DATA (OPTIONAL)
# ======================================================
# Enhanced real-time and historical market data
# Get API key from: https://polygon.io

POLYGON_API_KEY=""

# ======================================================
# ALPHA VANTAGE (OPTIONAL)
# ======================================================
# Fundamentals and economic indicators
# Free tier: https://www.alphavantage.co/support/#api-key

ALPHA_VANTAGE_API_KEY=""

# ======================================================
# SUPABASE CLOUD CACHE (OPTIONAL)
# ======================================================
# Cloud storage for caching (optional)
# Get credentials from: https://supabase.com

SUPABASE_URL=""
SUPABASE_SERVICE_ROLE_KEY=""
SUPABASE_ANON_KEY=""
SUPABASE_BUCKET="aion-cache"

# ======================================================
# NEWS & SENTIMENT APIs (OPTIONAL)
# ======================================================

# Perigon News API
# Get key from: https://www.goperigon.com
PERIGON_KEY=""

# NewsAPI
# Get key from: https://newsapi.org
NEWSAPI_KEY=""

# Finnhub Stock API
# Get key from: https://finnhub.io
FINNHUB_API_KEY=""

# MarketAux Financial News
# Get key from: https://www.marketaux.com
MARKETAUX_API_KEY=""

# RSS to JSON Converter
# Get key from: https://rss2json.com
RSS2JSON_KEY=""

# ======================================================
# SOCIAL SENTIMENT (OPTIONAL)
# ======================================================

# Reddit API (for WSB sentiment)
# Get credentials from: https://www.reddit.com/prefs/apps
REDDIT_CLIENT_ID=""
REDDIT_CLIENT_SECRET=""
REDDIT_USER_AGENT="AionAnalytics/1.0"

# Twitter/X API (optional)
TWITTER_BEARER=""

# ======================================================
# ECONOMIC DATA (OPTIONAL)
# ======================================================

# FRED Economic Data API
# Get key from: https://fred.stlouisfed.org/docs/api/api_key.html
FRED_API=""

# ======================================================
# MASSIVE DATA STORAGE (OPTIONAL)
# ======================================================
# Alternative S3-compatible storage
MASSIVE_API=""
MASSIVE_S3API=""
MASSIVE_S3API_SECRET=""
MASSIVE_S3_ENDPOINT="https://files.massive.com"
MASSIVE_S3_BUCKET="flatfiles"

# ======================================================
# ADMIN AUTHENTICATION
# ======================================================
# Password hash for admin access (use bcrypt or sha256)
# IMPORTANT: Generate your own hash - do not use this placeholder!
ADMIN_PASSWORD_HASH="REPLACE_WITH_ACTUAL_PASSWORD_HASH"
ADMIN_TOKEN_TTL_SECONDS=3600

# ======================================================
# SYSTEM PATHS
# ======================================================
# Storage directories (relative to project root)

# Main data directories
DATA_ROOT="data"
ML_DATA_ROOT="ml_data"
ML_DATA_DT_ROOT="ml_data_dt"
DA_BRAINS_ROOT="da_brains"
LOGS_ROOT="logs"
ANALYTICS_ROOT="analytics"

# Model storage
ML_MODELS_ROOT="ml_data/nightly/models"
ML_TMP_MEMMAP_ROOT="ml_data/tmp/memmap"

# DT-specific paths
DT_TRUTH_DIR="da_brains"
DT_ROLLING_PATH="da_brains/intraday/rolling_intraday.json.gz"
AION_POSITION_REGISTRY_PATH="da_brains/positions/position_registry.json"

# ======================================================
# TRADING CONTROLS
# ======================================================

# Enable/disable live trading (0=disabled, 1=enabled)
DT_ENABLE_LIVE_TRADING=0

# Dry run mode (1=paper trading, 0=live orders)
# ALWAYS test with DT_DRY_RUN=1 first!
DT_DRY_RUN=1

# Strategy tag for position registry
DT_STRATEGY_TAG="DT"

# ======================================================
# RISK MANAGEMENT
# ======================================================

# Position limits
DT_MAX_POSITIONS=3
DT_MAX_ORDERS_PER_CYCLE=3

# Daily risk limits
DT_DAILY_LOSS_LIMIT_USD=300.0
DT_DAILY_DRAWDOWN_PCT=2.0

# Weekly/monthly drawdown caps
DT_MAX_WEEKLY_DRAWDOWN_PCT=8.0
DT_MAX_MONTHLY_DRAWDOWN_PCT=15.0

# Per-symbol limits
DT_MAX_LOSS_PER_SYMBOL_DAY=500.0
DT_MAX_TRADES_PER_SYMBOL_PER_DAY=2

# Exposure limits
DT_MAX_EXPOSURE_FRAC=0.55

# VIX spike protection
DT_VIX_SPIKE_THRESHOLD=35.0
DT_PAUSE_ON_VIX_SPIKE=1

# Cooldown settings
DT_COOLDOWN_AFTER_LOSS_DELTAS=3
DT_COOLDOWN_MINUTES=20

# Risk equity source (auto|broker|ledger)
DT_RISK_EQUITY_SOURCE="auto"
DT_RISK_BROKER_TTL_SEC=180

# ======================================================
# EMERGENCY STOP
# ======================================================
# Emergency stop file path (create this file to halt trading)
DT_EMERGENCY_STOP_FILE="/tmp/dt_emergency_stop"

# ======================================================
# EXECUTION SETTINGS
# ======================================================

# Minimum confidence for trade execution (0.0-1.0)
DT_EXEC_MIN_CONF=0.25

# Default quantity per trade
DT_EXEC_DEFAULT_QTY=1

# Allow short selling (0=long only, 1=allow shorts)
DT_ALLOW_SHORTS=0

# Allow trading during lunch hour (12-1 PM ET)
DT_ALLOW_LUNCH_TRADES=1

# Minimum gap between bars (seconds)
DT_BARS_MIN_GAP_SEC_1M=30

# ======================================================
# UNIVERSE & CANDIDATE SELECTION
# ======================================================

# Universe size (number of symbols to track)
DT_UNIVERSE_SIZE=150

# Candidate universe size
DT_CANDIDATE_UNIVERSE_N=2000

# Manual candidate universe (comma-separated)
DT_CANDIDATE_UNIVERSE="SPY,QQQ,AAPL,MSFT,TSLA,NVDA,AMD,GOOGL,META,AMZN"

# Candidate universe file (optional, overrides manual list)
DT_CANDIDATE_UNIVERSE_FILE=""

# Universe file path
DT_UNIVERSE_FILE=""

# Market proxies for context
DT_MARKET_PROXIES="SPY,QQQ"

# Universe rotation settings
DT_UNIVERSE_ROTATION=1
DT_UNIVERSE_COOLDOWN_HOURS=2

# ======================================================
# STRATEGY SETTINGS
# ======================================================

# Strategy version
DT_STRATEGY_VERSION=""

# Buy/sell thresholds
DT_BUY_THRESHOLD=0.10
DT_SELL_THRESHOLD=-0.10
DT_MIN_CONFIDENCE=0.26

# Feature timeframe (1Min, 5Min, etc.)
DT_FEATURE_TF="5Min"

# Ignore micro regime (0=use regime, 1=ignore)
DT_IGNORE_MICRO_REGIME=0

# ======================================================
# TRADE FREQUENCY CONTROLS
# ======================================================

# Minimum minutes between trades on same symbol
DT_MIN_TRADE_GAP_MINUTES=15

# Score decay window (minutes)
DT_SCORE_DECAY_MINUTES=30

# ======================================================
# SCHEDULER SETTINGS
# ======================================================

# Trade cycle interval (seconds)
DT_TRADE_INTERVAL_SEC=""

# Scheduler tick interval (seconds)
DT_SCHED_TICK_SEC=""

# Cycle locking (prevents overlapping cycles)
DT_CYCLE_LOCK=1
DT_CYCLE_LOCK_TIMEOUT=5

# ======================================================
# LEDGER & RECONCILIATION
# ======================================================

# Reconcile broker positions on startup
DT_LEDGER_RECONCILE_ON_STARTUP=1
DT_LEDGER_RECONCILE_MODE="IMPORT"
DT_LEDGER_RECONCILE_SYNC_CASH=0

# ======================================================
# LIQUIDATION SETTINGS
# ======================================================

# Enable automatic position liquidation
DT_LIQUIDATE_ENABLED=1

# Target number of positions (liquidate down to this)
DT_LIQUIDATE_TARGET_POSITIONS=0

# Liquidation scope (ALL|DT|MANUAL)
DT_LIQUIDATE_SCOPE="ALL"

# Max liquidation orders per cycle
DT_LIQUIDATE_MAX_ORDERS_PER_CYCLE=50

# Deduplication settings
DT_LIQUIDATE_DEDUP_ENABLED=1
DT_LIQUIDATE_INFLIGHT_TTL_SEC=180

# ======================================================
# LOCKING & CONCURRENCY
# ======================================================

# Enable file locking
DT_USE_LOCK=1

# Lock timeout (seconds)
DT_LOCK_TIMEOUT=60

# Lock path
DT_LOCK_PATH=""

# Model lock timeout (seconds)
DT_MODEL_LOCK_TIMEOUT=180

# ======================================================
# SHADOW / A/B TESTING
# ======================================================

# Enable shadow mode (testing without execution)
DT_SHADOW_ENABLED=0

# Shadow cycle frequency (run every N cycles)
DT_SHADOW_EVERY_N=1

# Shadow top N symbols to evaluate
DT_SHADOW_TOP_N=25

# Shadow version tag
DT_SHADOW_VERSION=""

# ======================================================
# KNOBS HOT-RELOAD
# ======================================================

# Enable hot-reload of dt_knobs.env (1=enabled, 0=disabled)
DT_KNOBS_HOT_RELOAD=1

# Minimum seconds between knobs file checks
DT_KNOBS_RELOAD_MIN_SEC=1.0

# Custom knobs file path (optional)
# DT_KNOBS_PATH="/path/to/dt_knobs.env"

# ======================================================
# LOGGING & DEBUG
# ======================================================

# Log level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# Slack Integration for Logs
LOG_SLACK_ENABLED=1
LOG_SLACK_ERRORS_ONLY=0  # If 1, only send errors (not warnings/info)
LOG_BUFFER_SIZE=10  # Batch logs before sending to Slack
LOG_BUFFER_TIMEOUT_SEC=60  # Max time before flushing buffer

# Slack Channel Names (optional - defaults shown)
SLACK_CHANNEL_ERRORS=#errors
SLACK_CHANNEL_WARNINGS=#warnings
SLACK_CHANNEL_TESTING=#testing
SLACK_CHANNEL_TRADING=#trading
SLACK_CHANNEL_OPERATIONS=#operations
SLACK_CHANNEL_HEALTH=#health

# Log skipped trade setups (for debugging)
DT_LOG_SKIPPED_SETUPS=1

# Decision log top N entries
DT_DECISION_LOG_TOP_N=25

# Silence supervisor agent logs
SILENCE_SUPERVISOR_AGENT=0

# ======================================================
# BACKTEST & REPLAY SETTINGS
# ======================================================

# Backtest start equity
DT_BACKTEST_START_EQUITY=100000

# Replay version
DT_REPLAY_VERSION="phase6_v1"

# Time override for testing (ISO 8601 format)
# DT_NOW_UTC="2024-01-15T14:30:00Z"
DT_NOW_UTC=""

# Force new trading plan generation
DT_FORCE_NEW_PLAN=0

# Researcher rules path
DT_RESEARCHER_RULES_PATH=""

# ======================================================
# API SERVER SETTINGS
# ======================================================

# Backend API (unified port for all endpoints)
APP_HOST="0.0.0.0"
APP_PORT=8000
APP_WORKERS=2

# DT Backend API (Intraday)
DT_APP_HOST="0.0.0.0"
DT_APP_PORT=8010

# Replay Service API
REPLAY_APP_HOST="0.0.0.0"
REPLAY_APP_PORT=8020

# Server role (primary|ui)
# primary = owns scheduler, ui = read-only (deprecated - now unified)
AION_ROLE="primary"

# ======================================================
# ML TRAINING SETTINGS
# ======================================================

# Minimum rows required per horizon for training
ML_MIN_ROWS_PER_HORIZON=20000

# Target statistics validation
ML_MIN_TARGET_STD=0.0001
ML_MAX_TARGET_ZERO_FRAC=0.995

# Prediction validation
ML_MIN_PRED_STD=0.000001
ML_MAX_CLIP_SATURATION_FRAC=0.25

# Sample limits for performance
ML_MAX_STATS_SAMPLES=200000
ML_MAX_VAL_SAMPLES=80000

# Allow model fallback if primary model fails
DT_ALLOW_MODEL_FALLBACK=1

# ======================================================
# TIMEZONE
# ======================================================
# Timezone for market hours (Eastern Time)
AION_TZ="America/New_York"

# ======================================================
# FEATURE FLAGS (EXPERIMENTAL)
# ======================================================

# Enable experimental features (use with caution)
ENABLE_LSTM_MODELS=0
ENABLE_TRANSFORMER_MODELS=0
ENABLE_CONTINUOUS_LEARNING=0

# ======================================================
# MULTI-CHANNEL SLACK ALERTING
# ======================================================

# Critical errors, exceptions, crashes → #errors-tracebacks
SLACK_WEBHOOK_ERRORS=https://hooks.slack.com/services/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

# Trading system alerts (emergency stops) → #trading-alerts
SLACK_WEBHOOK_TRADING=https://hooks.slack.com/services/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

# Day trading alerts → #day_trading
SLACK_WEBHOOK_DT=https://hooks.slack.com/services/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

# Swing trading alerts → #swing_trading
SLACK_WEBHOOK_SWING=https://hooks.slack.com/services/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

# Nightly job summaries → #nightly-logs-summary
SLACK_WEBHOOK_NIGHTLY=https://hooks.slack.com/services/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

# Daily PnL updates → #daily-pnl
SLACK_WEBHOOK_PNL=https://hooks.slack.com/services/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

# Insights & model metrics → #reports
SLACK_WEBHOOK_REPORTS=https://hooks.slack.com/services/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

# Test alerts only → #testing
SLACK_WEBHOOK_TESTING=https://hooks.slack.com/services/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

# Alert settings
ALERT_RATE_LIMIT_SECONDS=300
ALERT_EMAIL_ENABLED=0
SLACK_TIMEOUT_SECONDS=5

# ======================================================
# TESTING INTEGRATION
# ======================================================

# Enable test result logging to Slack
TEST_LOG_TO_SLACK=0  # Set to 1 to enable test results in Slack
TEST_INCLUDE_PASS=1  # Include passing tests in Slack
TEST_INCLUDE_FAIL=1  # Include failing tests in Slack

# ======================================================
# SWING BOT ALERT SETTINGS
# ======================================================

# Enable detailed rejection alerts to #swing_trading (0=disabled, 1=enabled)
# When disabled (default), only rebalance summary with rejection stats is sent
# When enabled, individual rejection reasons are sent for debugging
SWING_SEND_REJECTIONS=0

# Maximum number of rejection alerts to send per rebalance (default: 20)
# Prevents Slack spam when many symbols are rejected
SWING_SEND_REJECTIONS_MAX=20

# ======================================================
# NOTES
# ======================================================
# 1. Start with DT_DRY_RUN=1 and DT_ENABLE_LIVE_TRADING=0 for safety
# 2. Test with small position sizes first
# 3. Monitor logs and metrics for 24-48 hours before scaling up
# 4. Use emergency stop file to halt trading instantly if needed
# 5. Review DEPLOYMENT.md for production setup guidelines
# ======================================================
